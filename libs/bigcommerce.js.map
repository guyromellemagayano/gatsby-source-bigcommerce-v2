{"version":3,"file":"bigcommerce.js","names":["BigCommerce","config","Error","client_id","secret","store_hash","response_type","headers","request_timeout","request_throttle_interval","request_debounce_interval","request_concurrency","request_max_count","request","url","method","body","fullPath","endpointUrl","URL","REQUEST_BIGCOMMERCE_API_URL","Request","run","data","isEmpty","isObjectType","meta","pagination","totalPages","total_pages","currentPage","current_page","promises","nextPage","searchParams","set","push","pathname","search","Promise","allSettled","responses","forEach","status","value","concat","get","results","post"],"sources":["../src/libs/bigcommerce.js"],"sourcesContent":["\"use strict\";\n\nimport { REQUEST_BIGCOMMERCE_API_URL } from \"../constants\";\nimport { isEmpty, isObjectType } from \"../utils/typeCheck\";\nimport { Request } from \"./request\";\n\nexport class BigCommerce {\n\tconstructor(config) {\n\t\tif (!config) {\n\t\t\tthrow new Error(\"BigCommerce API config required. It is required to make any call to the API\");\n\t\t}\n\n\t\tthis.client_id = config.client_id;\n\t\tthis.secret = config.secret;\n\t\tthis.store_hash = config.store_hash;\n\t\tthis.response_type = config.response_type;\n\t\tthis.headers = config.headers;\n\t\tthis.request_timeout = config.request_timeout;\n\t\tthis.request_throttle_interval = config.request_throttle_interval;\n\t\tthis.request_debounce_interval = config.request_debounce_interval;\n\t\tthis.request_concurrency = config.request_concurrency;\n\t\tthis.request_max_count = config.request_max_count;\n\t}\n\n\t// Handle API requests\n\tasync request({ url = null, method = \"\", body = null, headers = null }) {\n\t\t// Update full path\n\t\tlet fullPath = `/stores/${this.store_hash + url}`;\n\t\tlet endpointUrl = new URL(fullPath, REQUEST_BIGCOMMERCE_API_URL);\n\n\t\t// Prepare `url` for request execution\n\t\tconst request = new Request(REQUEST_BIGCOMMERCE_API_URL, {\n\t\t\theaders: {\n\t\t\t\t...this.headers,\n\t\t\t\t...headers\n\t\t\t},\n\t\t\tresponse_type: this.response_type,\n\t\t\trequest_timeout: this.request_timeout,\n\t\t\trequest_throttle_interval: this.request_throttle_interval,\n\t\t\trequest_debounce_interval: this.request_debounce_interval,\n\t\t\trequest_max_count: this.request_max_count,\n\t\t\trequest_concurrency: this.request_concurrency\n\t\t});\n\n\t\t// Run request\n\t\tconst { data } = await request.run({ url: fullPath, method, body, headers });\n\n\t\t// If response contains pagination, run request again for each page\n\t\tif (!isEmpty(data) && isObjectType(data)) {\n\t\t\tif (\"meta\" in data) {\n\t\t\t\tif (\"pagination\" in data.meta) {\n\t\t\t\t\tconst { total_pages: totalPages, current_page: currentPage } = data.meta.pagination;\n\n\t\t\t\t\t// If current page is not the last page.\n\t\t\t\t\tif (totalPages > currentPage) {\n\t\t\t\t\t\t// Collect all page request promises in array.\n\t\t\t\t\t\tconst promises = [];\n\n\t\t\t\t\t\tfor (let nextPage = currentPage + 1; nextPage <= totalPages; nextPage++) {\n\t\t\t\t\t\t\t// Safely assign `page` query parameter to endpoint URL.\n\t\t\t\t\t\t\tendpointUrl.searchParams.set(\"page\", nextPage);\n\n\t\t\t\t\t\t\t// Add promise to array for future Promise.allSettled() call.\n\t\t\t\t\t\t\tpromises.push(request.run({ url: `${endpointUrl.pathname}${endpointUrl.search}`, method, body, headers }));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Request all endpoints in parallel.\n\t\t\t\t\t\tconst responses = await Promise.allSettled(promises);\n\n\t\t\t\t\t\tresponses.forEach(({ status, value }) => {\n\t\t\t\t\t\t\tif (status === \"fulfilled\") {\n\t\t\t\t\t\t\t\tdata.data = data.data.concat(value.data.data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Set pager to last page.\n\t\t\t\t\t\tdata.meta.pagination.total_pages = totalPages;\n\t\t\t\t\t\tdata.meta.pagination.current_page = totalPages;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Return data\n\t\treturn data;\n\t}\n\n\t/**\n\t * @description Handle `GET` requests\n\t * @param {String} url\n\t * @param {Object} body\n\t * @param {Object} headers\n\t * @returns {Promise} Response promise\n\t */\n\tasync get({ url = null, body = null, headers = null }) {\n\t\tconst results = await this.request({ url, method: \"get\", body, headers });\n\n\t\treturn results;\n\t}\n\n\t/**\n\t * @description Handle `POST` requests\n\t * @param {String} url\n\t * @param {Object} body\n\t * @param {Object} headers\n\t * @returns {Promise} Response promise\n\t */\n\tasync post({ url = null, body = null, headers = null }) {\n\t\tconst results = await this.request({ url, method: \"post\", body, headers });\n\n\t\treturn results;\n\t}\n}\n"],"mappings":"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"}