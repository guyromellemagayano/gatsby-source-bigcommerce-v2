"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.BigCommerce=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_constants=require("../constants"),_typeCheck=require("../utils/typeCheck"),_request2=require("./request"),BigCommerce=function(){function BigCommerce(config){if(!config)throw new Error("BigCommerce API config required. It is required to make any call to the API");this.client_id=config.client_id,this.secret=config.secret,this.store_hash=config.store_hash,this.response_type=config.response_type,this.headers=config.headers,this.request_timeout=config.request_timeout,this.request_throttle_interval=config.request_throttle_interval,this.request_debounce_interval=config.request_debounce_interval,this.request_concurrency=config.request_concurrency,this.request_max_count=config.request_max_count}var _proto=BigCommerce.prototype;return _proto.request=function(){function request(){return _request.apply(this,arguments)}var _request=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(_ref){var _ref$url,url,_ref$method,method,_ref$body,body,_ref$headers,headers,fullPath,endpointUrl,request,_yield$request$run,data,_data$meta$pagination,totalPages,currentPage,promises,nextPage,responses;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _ref$url=_ref.url,url=void 0===_ref$url?null:_ref$url,_ref$method=_ref.method,method=void 0===_ref$method?"":_ref$method,_ref$body=_ref.body,body=void 0===_ref$body?null:_ref$body,_ref$headers=_ref.headers,headers=void 0===_ref$headers?null:_ref$headers,fullPath="/stores/"+(this.store_hash+url),endpointUrl=new URL(fullPath,_constants.REQUEST_BIGCOMMERCE_API_URL),request=new _request2.Request(_constants.REQUEST_BIGCOMMERCE_API_URL,{headers:(0,_extends2.default)({},this.headers,headers),response_type:this.response_type,request_timeout:this.request_timeout,request_throttle_interval:this.request_throttle_interval,request_debounce_interval:this.request_debounce_interval,request_max_count:this.request_max_count,request_concurrency:this.request_concurrency}),_context.next=6,request.run({url:fullPath,method:method,body:body,headers:headers});case 6:if(_yield$request$run=_context.sent,data=_yield$request$run.data,(0,_typeCheck.isEmpty)(data)||!(0,_typeCheck.isObjectType)(data)){_context.next=21;break}if(!("meta"in data)){_context.next=21;break}if(!("pagination"in data.meta)){_context.next=21;break}if(_data$meta$pagination=data.meta.pagination,totalPages=_data$meta$pagination.total_pages,currentPage=_data$meta$pagination.current_page,!(totalPages>currentPage)){_context.next=21;break}for(promises=[],nextPage=currentPage+1;nextPage<=totalPages;nextPage++)endpointUrl.searchParams.set("page",nextPage),promises.push(request.run({url:""+endpointUrl.pathname+endpointUrl.search,method:method,body:body,headers:headers}));return _context.next=17,Promise.allSettled(promises);case 17:responses=_context.sent,responses.forEach(function(_ref2){var status=_ref2.status,value=_ref2.value;"fulfilled"===status&&(data.data=data.data.concat(value.data.data))}),data.meta.pagination.total_pages=totalPages,data.meta.pagination.current_page=totalPages;case 21:return _context.abrupt("return",data);case 22:case"end":return _context.stop();}},_callee,this)}));return request}(),_proto.get=function(){function get(){return _get.apply(this,arguments)}var _get=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(_ref3){var _ref3$url,url,_ref3$body,body,_ref3$headers,headers,results;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _ref3$url=_ref3.url,url=void 0===_ref3$url?null:_ref3$url,_ref3$body=_ref3.body,body=void 0===_ref3$body?null:_ref3$body,_ref3$headers=_ref3.headers,headers=void 0===_ref3$headers?null:_ref3$headers,_context2.next=3,this.request({url:url,method:"get",body:body,headers:headers});case 3:return results=_context2.sent,_context2.abrupt("return",results);case 5:case"end":return _context2.stop();}},_callee2,this)}));return get}(),_proto.post=function(){function post(){return _post.apply(this,arguments)}var _post=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(_ref4){var _ref4$url,url,_ref4$body,body,_ref4$headers,headers,results;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _ref4$url=_ref4.url,url=void 0===_ref4$url?null:_ref4$url,_ref4$body=_ref4.body,body=void 0===_ref4$body?null:_ref4$body,_ref4$headers=_ref4.headers,headers=void 0===_ref4$headers?null:_ref4$headers,_context3.next=3,this.request({url:url,method:"post",body:body,headers:headers});case 3:return results=_context3.sent,_context3.abrupt("return",results);case 5:case"end":return _context3.stop();}},_callee3,this)}));return post}(),BigCommerce}();exports.BigCommerce=BigCommerce;
//# sourceMappingURL=bigcommerce.js.map